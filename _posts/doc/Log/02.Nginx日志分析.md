# 设置nginx日志格式


```
#在nginx.conf 中设置日志格式：logstash
log_format logstash '$remote_addr - $remote_user [$time_local] "$request" $http_host $status $body_bytes_sent "$http_referer" "$http_user_agent" "$http_x_forwarded_for" $upstream_addr $upstream_status $upstream_cache_status "$upstream_http_content_type" $upstream_response_time > $request_time';
                    
#在vhost/*.conf中设置access日志
access_log  /logs/xlog.log  logstash;
```


```
input {
   file {
       type => "nginx_access"
       path => ["d:/nginx/logs/access.log","d:/nginx/logs/access.log"]
   }
}
filter {
    #定义数据的格式
    grok {
		match => { 
        	"message" => "%{IPORHOST:client_ip} %{USER:ident} %{USER:auth} \[%{HTTPDATE:timestamp}\] "(?:%{WORD:verb} %{NOTSPACE:request}(?: HTTP/%{NUMBER:http_version})?|-)" %{HOST:domain} %{NUMBER:response} (?:%{NUMBER:bytes}|-) %{QS:referrer} %{QS:agent} "(%{WORD:x_forword}|-)" (%{URIHOST:upstream_host}|-) %{NUMBER:upstream_response} (%{WORD:upstream_cache_status}|-) %{QS:upstream_content_type} (%{BASE16FLOAT:upstream_response_time}) > (%{BASE16FLOAT:request_time})"
		}
	}
}
output {
   elasticsearch {
       hosts => ["localhost:9200"]
       index => "service_api"
       document_type => "logs“
   }
}
```