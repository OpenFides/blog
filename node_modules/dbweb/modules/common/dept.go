package common

import (
	"dbweb/core"

	"dbweb/lib/model"
)

const (
	modelDeptName = "DEPT"
)

//DeptControler 业务
type deptControler struct{}

type modelDept struct {
	Code   string `dbx:"STR(50) PRIMARY KEY"`
	Name   string `dbx:"STR(50) NOT NULL"`
	DLevel int64  `dbx:"INT NOT NULL"`
}

//OnAfterSchemaUpdate 自动运行，用于填充数据
func (m modelDept) OnAfterSchemaUpdate(md *model.Model, oldver int64) error {
	if oldver == 0 {
		return md.Set(modelDept{Code: "r", Name: "root", DLevel: 0})
	}
	return nil
}
func init() {
	core.RegisterModel(modelDept{}, 2, true, modelDeptName)
	core.RegisterBill("dept", new(deptControler), modelDeptName)
	core.RegisterInstitutionModel(core.DeptRoot, modelDeptName,
		"code in ({{P .User.ToRootDeptCodesAndSelf}})", "", "")
}
