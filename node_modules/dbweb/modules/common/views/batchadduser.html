<form role="form" class="form-horizontal" action="{{.Req.URL.String}}" method="POST">
	<div class="modal fade">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h4 class="modal-title">{{.Element.DisplayLabel}}-{{.More.FromElement.DisplayLabel}}{{template "helpicon" .}}</h4>
				</div>
				<div class="modal-body">
					{{if .More.Error}}
					<div id="divError" class="alert alert-danger" role="alert"></div>
					{{end}}
					<pre class="text-danger" id="message" style="display: none;">
						<div id="mess"></div>
					</pre>
					<div class='row form-group'>
						<div class='col-md-12 nopadding'>
							<label for="user" class="control-label">用户名密码:</label>
							<textarea id="user" class="form-control" wrap='off' rows=10 name="user" style="resize: none;"></textarea>
						</div>
					</div>
					<div class="row form-group">
						<div class="col-md-1">注:</div>
						<div class="col-md-11">
							<li>每行输入一对用户名密码</li>
							<li>用户名在前， 密码在后，使用制表符、空格隔开</li>
							<li>可以从Excel表格中复制数据粘贴到本功能中</li>
							<li>每次最多批量添加1000条用户记录</li>
							<li>自动去除输入或者粘贴数据中的空行</li>
						</div>
					</div>
					<div class="form-group">
						<label for="fldUSERROLE" class="col-xs-2">角色:</label>
						<div class="col-xs-10" id="fldUSERROLE">
							{{range $idx,$role := .More.Roles}} 
								{{if eq 0 (mod $idx 3)}}
								<div class="row rolerow">
								{{end}}
								<div class="col-sm-4 checkbox">
									<input id="chk{{$idx}}" type="checkbox" value="{{$role}}" name="chkrole">
									<label for="chk{{$idx}}">{{$role}}</label>
								</div>
								{{if eq 0 (mod (inc $idx) 3)}}
							</div>
							{{end}} {{end}}
						</div>
					</div>
				</div>
				<div class="modal-footer">
					<button id="btnOk" type="submit" class="btn btn-primary"><i class="fa fa-check"></i> 执行</button>
					<button id="btnClose" type="button" class="btn btn-default"><i class="fa fa-close"></i> 关闭</button>
				</div>
			</div>
			<!-- /.modal-content -->
		</div>
		<!-- /.modal-dialog -->
	</div>
	<!-- /.modal -->
</form>
<script>
	$(".modal").modal({ backdrop: "static" });

	$("#btnClose").click(function () {
		window.close();
	})

	$("form").submit(function (e) {
		e.preventDefault();
		$.ajax({
			type: $("form").attr("method"),
			url: $("form").attr("action"),
			data: $("form").serialize(),
		}).done(function(data){
			$("#mess").text(data);
			if (data == "添加成功") {
				window.close();
			}
		}).fail(function(data){
			$("#mess").val(data);
		}).always(function() {
			$("#message").show();
		})
		$("#divError").hide();
	})
</script>