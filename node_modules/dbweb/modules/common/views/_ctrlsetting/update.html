{{with $param :=.More.JSONParams}}
<link rel="stylesheet" type="text/css" href="[[concat (newFiles "update.css")]]">
[[$files := newFiles]]
[[append $files "/flib/papaparse/papaparse.js" "/flib/papaparse/papaparse.min.js"]]
[[append $files "/flib/uri.js/src/URI.js" "/flib/uri.js/src/URI.min.js"]]
[[append $files "update.js"]]
<script src="[[concat $files]]" type="text/javascript" charset="utf-8"></script>
<script type="text/template" id="tmpField">
	<tr class="text-muted">
		<td>
			<div class="checkbox checkbox-inline checkbox-success">
				<input type='checkbox' class='chkSelect'>
				<label class="lblName"></label>
			</div>
		</td>
		<td>
			<input type='text' class='form-control edtLabel'>
		</td>
		<td>
			<input type='text' class='form-control edtTooltip'>
		</td>
		<td>
			<div class="checkbox checkbox-inline checkbox-success">
				<input type='checkbox' class='chkMust'>
				<label class="lblMust">必填</label>
			</div>
		</td>
		<td>
			<div class="checkbox checkbox-inline checkbox-success">
				<input type='checkbox' class='chkFreeentry'>
				<label class="lblFreeentry">自由录入</label>
			</div>
		</td>
		<td>
			<input type='text' class='form-control edtList'>
		</td>
	</tr>
</script>
<div id="update_param_setting" class="bill-field" data-bill-fieldname="PARAMS">
	<form class="form-horizontal">
		<div class="form-group">
			<label for="selDB" class="col-sm-1 control-label">数据库:</label>
			<div class="col-sm-5">
				<select class="select2" style="width:100%" id="selDB">
					{{range $.More.OuterdbNames}}
					<option value="{{.}}" {{if eq $param.DB .}} selected="selected"{{end}}>{{if .}}{{.}}{{else}}(当前数据库){{end}}</option>
					{{end}}
				</select>
			</div>
			<label for="selTable" class="col-sm-1 control-label">表:</label>
			<div class="col-sm-5">
				<select class="select2" style="width:100%" id="selTable">
				</select>
			</div>
		</div>
		<div class="form-group">
			<label for="txtAdditionWhere" class="col-sm-1 control-label">数据范围:</label>
			<div class="col-sm-11">
				<textarea id="txtAdditionWhere" class="form-control">
				{{- $param.AdditionWhere -}}
				</textarea>
			</div>
		</div>
	</form>
	<table id="tabFields" class="table table-hover table-striped">
		<thead>
			<tr>
				<th style="width:10%">
					<div class="checkbox checkbox-inline checkbox-success">
						<input id="chkAllName" type='checkbox'>
						<label for="chkAllName">名称</label>
					</div>
				</th>
				<th style="width:15%">标签</th>
				<th style="width:15%">提示</th>
				<th style="width:10%">
					<div class="checkbox checkbox-inline checkbox-success">
						<input id="chkAllMust" type='checkbox'>
						<label for="chkAllMust">必填</label>
					</div>
				</th>
				<th style="width:10%">
					<div class="checkbox checkbox-inline checkbox-success">
						<input id="chkAllFreeentry" type='checkbox'>
						<label for="chkAllFreeentry">自由录入</label>
					</div>
				</th>
				<th style="width:30%">列表(用逗号分隔各项,等号分隔值和标签,表达式用``包括)</th>
			</tr>
		</thead>
		<tbody>
		</tbody>
	</table>
	<form >
		<div class="form-group">
			<label for="edtAdditionSet" class="control-label">附加的set子句:</label>
			<div id="edtAdditionSet">{{$param.AdditionSet}}</div>
		</div>
		<div class="form-group">
			<label for="edtBeforeSQL" class="control-label">附加执行的SQL(用DataSQL引用传入的数据范围SQL):</label>
			<div id="edtBeforeSQL">{{$param.BeforeSQL}}</div>
		</div>
	</form>	
</div>
<script>
	initUpdate({{$.More.TableNames}},{{$param.Fields}},{{.TableName}});
</script>
{{end}}
