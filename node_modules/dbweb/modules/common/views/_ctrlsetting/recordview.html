{{with $param :=.More.JSONParams}}
<link rel="stylesheet" type="text/css" href="[[concat (newFiles "recordview.css")]]">
[[$files := newFiles]]
[[append $files "/flib/Sortable/Sortable.min.js" "/flib/Sortable/Sortable.min.js"]]
[[append $files "/flib/uri.js/src/URI.js" "/flib/uri.js/src/URI.min.js"]]
[[append $files "recordview.js"]]
<script src="[[concat $files]]" type="text/javascript" charset="utf-8"></script>
<script type="text/template" id="tmpProcess">
<li class="list-group-item">
	<form class="form-horizontal">
		<div class="form-group">
			<div class='col-sm-1 btn-group btn-group-sm nopadding'>
				<button type='button' class='btn btn-primary btnProcessAdd' {{if ($.Field "PARAMS").Readonly}}disabled{{end}}><i class='fa fa-plus'></i></button>
				<button type='button' class='btn btn-danger btnProcessRemove' {{if ($.Field "PARAMS").Readonly}}disabled{{end}}><i class='fa fa-minus'></i></button>
			</div>
			<label class="control-label col-sm-1">名称:</label>
			<div class="col-sm-2 nopadding">
				<input type="text" class="edtProcessName form-control" {{if ($.Field "PARAMS").Readonly}}readonly="readonly"{{end}}>
			</div>
			<label class="control-label col-sm-1">工作元素:</label>
			<div class="col-sm-3 nopadding">
				<select class="select2 edtProcessElementName" style="width:100%" {{if ($.Field "PARAMS").Readonly}}disabled{{end}}>
				</select>
			</div>
			<div class="col-md-3">
				<div class="checkbox"> 
			      <input type="checkbox" class="chkProcessBindRecord" {{if ($.Field "PARAMS").Readonly}}disabled="disabled"{{end}}>
				  <label class="lblProcessBindRecord">绑定记录</label>
				  <input type="checkbox" class="chkProcessWithSql" {{if ($.Field "PARAMS").Readonly}}disabled="disabled"{{end}}>
				  <label class="lblProcessWithSql">传送SQL</label>
				</div>
			</div>
			<div class="col-md-1">
				<button type="button" class="btn btn-default btnProcessUp" {{if ($.Field "PARAMS").Readonly}}disabled{{end}}><i class="fa fa-arrow-up"></i></button>
			</div>
		</div>
		<div class="form-group">
			<label class="control-label col-sm-2">主键:</label>
			<div class="col-sm-2 nopadding">
				<select class="select2 selProcessTransPath" multiple="multiple" style="width:100%" {{if ($.Field "PARAMS").Readonly}}disabled{{end}}>
				</select>
			</div>
			<label class="control-label col-sm-1">参数:</label>
			<div class="col-sm-6 nopadding">
				<input type="text" class="form-control edtProcessTransQuery" {{if ($.Field "PARAMS").Readonly}}readonly="readonly"{{end}}>
			</div>
			<div class="col-md-1">
				<button type="button" class="btn btn-default btnProcessDown" {{if ($.Field "PARAMS").Readonly}}disabled{{end}}><i class="fa fa-arrow-down"></i></button>
			</div>
		</div>
		<div class="form-group">
			<label class="control-label col-sm-2">显示条件:</label>
			<div class="col-sm-10 nopadding">
				<input type="text" class="form-control edtProcessVisable" {{if ($.Field "PARAMS").Readonly}}readonly="readonly"{{end}}>
			</div>
		</div>
	</form>
</li>
</script>
<div role="tabpanel" class="tabMain bill-field" id="recordview_param_setting" data-bill-fieldname="PARAMS">
	<!-- Nav tabs -->
	<ul class="nav nav-tabs" role="tablist">
		<li role="presentation" class="active"><a href="#divSql" aria-controls="term" role="tab" data-toggle="tab">取数定义</a></li>
		<li role="presentation"><a href="#divColumns" aria-controls="columns" role="tab" data-toggle="tab">显示的列</a></li>
		<li role="presentation"><a href="#divProcess" aria-controls="columns" role="tab" data-toggle="tab">处理列表</a></li>
		<li role="presentation"><a href="#divColumnTypes" aria-controls="columntypes" role="tab" data-toggle="tab">数据类型</a></li>
	</ul>
	<!-- Tab panes -->
	<div class="tab-content">
		<div role="tabpanel" class="tab-pane fade in active" id="divSql">
			<div class='container-fluid'>
				<form class="form-horizontal">
					<div class="form-group">
						<label for="selDB" class="col-sm-1 control-label">数据库:</label>
						<div class="col-sm-5">
							<select class="select2" style="width:100%" id="selDB" {{if ($.Field "PARAMS").Readonly}}disabled{{end}}>
								{{range $.More.OuterdbNames}}
								<option value="{{.}}" {{if eq $param.DB .}} selected="selected"{{end}}>{{if .}}{{.}}{{else}}(当前数据库){{end}}</option>
								{{end}}
							</select>
						</div>
						<label for="selTable" class="col-sm-1 control-label">表:</label>
						<div class="col-sm-5">
							<select class="select2" style="width:100%" id="selTable" {{if ($.Field "PARAMS").Readonly}}disabled{{end}}>
							</select>
						</div>
					</div>
					<div class="form-group">
						<label for="selUniqueField" class="col-sm-1 control-label">主键:</label>
						<div class="col-sm-5">
							<select class="select2" style="width:100%" id="selUniqueField" multiple="multiple" {{if ($.Field "PARAMS").Readonly}}disabled{{end}}>
								{{range $.More.PrimaryKeys}}
								<option value="{{.}}" {{if contains $param.UniqueField .}} selected="selected"{{end}}>{{.}}</option>
								{{end}}
							</select>
						</div>
						<div class="col-md-1"></div>
						<div class="checkbox col-md-5">
					        <input type="checkbox" id="chkManualPage" {{if ($.Field "PARAMS").Readonly}}disabled{{end}} {{if $param.ManualPage}}checked="checked"{{end}}>
							<label for="chkManualPage">手工分页</label>
							<button class="btn btn-default" type="button" id="btnSample">生成SQL</button>
					    </div>
					</div>
					<div class="form-group">
						<label for="edtSql" class="col-sm-1 control-label">SQL:</label>
						<div class="col-sm-11">
							<div id="edtSql"></div>
						</div>
					</div>
					<div class="form-group">
						<div class="col-sm-11 col-md-offset-1">
							<button class="btn btn-default" type="button" id="btnCheckSql">验证SQL</button>
							<pre class="text-danger" id="infoMessage"></pre>
						</div>
					</div>
				</form>
			</div>
		</div>
		<div role="tabpanel" class="tab-pane fade" id="divColumns">
			<div class='container-fluid'>
				<div class="row">
					<div class="col-md-6">
						<div class="row">
							<div class="col-md-12">
								<div class="row">
									<div class="col-md-3">
										<input type="checkbox" autocomplete="off" class="chkAllColumn" checked {{if ($.Field "PARAMS").Readonly}}disabled{{end}}>
										可用列
									</div>
									<div class="col-md-2">
										<button class="btn btn-sm btn-default btnAllColumn" type="button" {{if ($.Field "PARAMS").Readonly}}disabled{{end}}><i class="fa fa-arrow-right"></i></button>
									</div>
									<div class="col-md-7">
										<input type="text" id="colFilter" class="form-control" {{if ($.Field "PARAMS").Readonly}}disabled{{end}}>
									</div>
								</div>
							</div>
						</div>
						<div class="row">
							<ul class="list-group allcolumn col-md-12">
							</ul>
						</div>
					</div>
					<div class="col-md-6">
						<div class="row">
							<div class="col-md-12">
								<input type="checkbox" autocomplete="off" class="chkSelColumn" checked {{if ($.Field "PARAMS").Readonly}}disabled{{end}}>
								<button class="btn btn-sm btn-default btnSelColumn" type="button" {{if ($.Field "PARAMS").Readonly}}disabled{{end}}><i class="fa fa-arrow-left"></i></button>
								显示列
							</div>
						</div>
						<div class="row">
							<ul class="list-group selcolumn col-md-12">
							</ul>
						</div>
					</div>
				</div>
			</div>
		</div>
		<div role="tabpanel" class="tab-pane fade" id="divProcess">
			<div class='container-fluid nopadding'>
			<ul class="list-group" id="ulProcess">
			</ul>
			</div>
		</div>
		<div role="tabpanel" class="tab-pane fade" id="divColumnTypes">
			<button id="btnRebuildTypes" class="btn btn-primary" type="button">重新获取</button>
			<table id="tabColumnTypes" class="table table-striped table-hover table-condensed">
				<thead>
					<tr>
						<th>序号</th>
						<th>名称</th>
						<th>类型</th>
					</tr>
				</thead>
				<tbody>
				</tbody>
			</table>
		</div>
	</div>
</div>
<script>
	initRecordView({{.Columns}},{{.AllColumns}},{{.UniqueField}},{{$.More.TableNames}},{{.TableName}},
	{{($.Field "PARAMS").Readonly}},{{$.More.ElementNames}},{{.Processes}},{{.Sql}});
</script>
{{end}}
