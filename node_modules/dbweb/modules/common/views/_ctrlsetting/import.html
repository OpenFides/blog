{{with $param :=.More.JSONParams}}
[[$files := newFiles]]
[[append $files "/flib/uri.js/src/URI.js" "/flib/uri.js/src/URI.min.js"]]
[[append $files "import.js"]]
<script src="[[concat $files]]" type="text/javascript" charset="utf-8"></script>
<style type="text/css">
	.control-label{
		padding:0px;
	}
	.sql-editor{border: 1px solid #ccc; font-size:13px;height:150px;}
</style>
<script type="text/templater" id="tmplRow">
<tr>
	<td><p class="form-control-static lblNo"></p></td>
	<td><p class="form-control-static lblName"></p></td>
	<td>
		<select class="form-control selStyle">
			<option value="NORMAL">正常导入字段</option>
			<option value="MUST">必须导入的字段</option>
			<option value="FILL">自动填充的字段</option>
			<option value="SKIP">忽略的字段</option>
		</select>
	</td>
	<td><input type="text" class="form-control edtValue" placeholder="值"></td>
	<td><input type="text" class="form-control edtRemark" placeholder="备注"></td>
	<td>
		<div class='col-sm-1 btn-group btn-group-sm nopadding' style="width:100px">
			<button type='button' class='btn btn-default btnUp' {{if ($.Field "PARAMS").Readonly}}disabled{{end}}><i class='fa fa-arrow-up'></i></button>
			<button type='button' class='btn btn-default btnDown' {{if ($.Field "PARAMS").Readonly}}disabled{{end}}><i class='fa fa-arrow-down'></i></button>
		</div>
	</td>
</tr>
</script>
<form class="form-horizontal">
	<div class="form-group">
		<label for="selDB" class="col-sm-1 control-label">数据库:</label>
		<div class="col-sm-5">
			<select class="select2" style="width:100%" id="selDB" {{if ($.Field "PARAMS").Readonly}}disabled{{end}}>
				{{range $.More.OuterdbNames}}
				<option value="{{.}}" {{if eq $param.DB .}} selected="selected"{{end}}>{{if .}}{{.}}{{else}}(当前数据库){{end}}</option>
				{{end}}
			</select>
		</div>
		<label for="selTable" class="col-sm-1 control-label">表:</label>
		<div class="col-sm-5">
			<select class="select2" style="width:100%" id="selTable" {{if ($.Field "PARAMS").Readonly}}disabled{{end}}>
			</select>
		</div>
	</div>
</form>
<div role="tabpanel" class="tabMain bill-field" id="import_param_setting" data-bill-fieldname="PARAMS">
	<!-- Nav tabs -->
	<ul class="nav nav-tabs" role="tablist">
		<li role="presentation" class="active"><a href="#divSql" aria-controls="term" role="tab" data-toggle="tab">基本属性</a></li>
		<li role="presentation"><a href="#divColumns" aria-controls="columns" role="tab" data-toggle="tab">字段设置</a></li>
	</ul>
	<!-- Tab panes -->
	<div class="tab-content">
		<div role="tabpanel" class="tab-pane fade in active" id="divSql">
			<div class='container-fluid'>
				<form class="form-horizontal">
					<div class="form-group">
						<label class="control-label col-md-1" for="edtWhere" class="control-label">Where:</label>
						<div class="col-md-11">
							<div id="edtWhere" class="sql-editor">{{.Where}}</div>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-md-1" for="edtBefore" class="control-label">Before:</label>
						<div class="col-md-11">
							<div>用ImportTempTable引用临时表</div>
							<div id="edtBefore" class="sql-editor">{{.Before}}</div>
						</div>
					</div>
					<div class="form-group">
						<label class="control-label col-md-1" for="edtAfter" class="control-label">After:</label>
						<div class="col-md-11">
							<div id="edtAfter" class="sql-editor">{{.After}}</div>
						</div>
					</div>
				</form>
			</div>
		</div>
		<div role="tabpanel" class="tab-pane fade" id="divColumns">
			<div class='container-fluid'>
				<table class="table table-striped table-hover" id="tabRows">
					<thead>
						<tr>
							<th>序号</th>
							<th>名称</th>
							<th>类别</th>
							<th>值</th>
							<th>备注</th>
							<th></th>
						</tr>
					</thead>
					<tbody>
					</tbody>
				</table>
			</div>
		</div>
	</div>
</div>
<script>
	initImport({{($.Field "PARAMS").Readonly}},{{.Fields}},{{$.More.TableNames}},{{.Table}});
</script>
{{end}}
