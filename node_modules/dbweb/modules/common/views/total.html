<style type="text/css">
	
	.nopadding{
		padding-left:0px;
		padding-right:0px;
	}
</style>
<form role="form" class="form form-horizontal" action="{{.Req.URL.String}}" method="POST">
<div class="modal fade">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h4 class="modal-title">{{.More.FromElement.DisplayLabel}}-交叉汇总{{template "helpicon" .}}</h4>
      </div>
      <div class="modal-body">
		<div class="form-group">
			<div class="col-md-2"></div>
			<div class="col-md-4 text-center">指标</div>
			<div class="col-md-6 text-center">处理方式</div>
		</div>
		<div class="row">
			<label for="sel主栏" class="control-label col-md-2">主栏:</label>
			<div class="form-group col-md-4">
				<select class="form-control select2" id="sel主栏" name="主栏">
					{{range .More.Columns}}
					<option data-type="{{.Type.String}}">{{.Name}}</option>
					{{end}}
				</select>
			</div>
			<div class="col-md-6 input-group">
				<div class="input-group-btn">
					<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span id="sp主栏Express" class="express">(无)</span> <span class="caret"></span></button>
					<ul class="dropdown-menu">
						<li><a href="#">(无)</a></li>
						<li><a href="#">截前N位</a></li>
						<li><a href="#">表达式</a></li>
					</ul>
				</div><!-- /btn-group -->
				<input type="hidden" id="edt主栏Express" name="主栏Express" value="(无)">
				<input type="text" id="edt主栏Value" name="主栏Value" class="form-control" aria-label="...">
			</div><!-- /input-group -->
			
		</div>
		<div class="row">
			<label for="sel宾栏" class="control-label col-md-2">宾栏:</label>
			<div class="form-group col-md-4">
				<select class="form-control select2" id="sel宾栏" name="宾栏">
					<option>(合计)</option>
					{{range .More.Columns}}
					<option data-type="{{.Type.String}}">{{.Name}}</option>
					{{end}}
				</select>
			</div>
			<div class="input-group col-md-6">
				<div class="input-group-btn">
					<button type="button" class="btn btn-default dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span id="sp宾栏Express" class="express">(无)</span> <span class="caret"></span></button>
					<ul class="dropdown-menu">
						<li><a href="#">(无)</a></li>
						<li><a href="#">截前N位</a></li>
						<li><a href="#">表达式</a></li>
					</ul>
				</div><!-- /btn-group -->
				<input type="hidden" id="edt宾栏Express" name="宾栏Express" value="(无)">
				<input type="text" id="edt宾栏Value" name="宾栏Value" class="form-control" aria-label="...">
			</div>
			
		</div>
		<div class="row">
			<label for="sel汇总指标" class="control-label col-md-2">汇总指标:</label>
			<div class="form-group col-md-4">
				<select class="form-control select2" id="sel汇总指标" name="汇总指标">
					<option>(记录数)</option>
					{{range .More.Columns}}
					{{if in .Type.String "INT" "FLOAT"}}
					<option data-type="{{.Type.String}}">{{.Name}}</option>
					{{end}}
					{{end}}
				</select>
			</div>
		</div>
		<div id="divError" class="alert alert-danger" role="alert" style="display:none"></div>
      </div>
	
      <div class="modal-footer">
			<button id="btnOk" type="button" class="btn btn-primary"><i class="fa fa-check"></i> 执行</button>
	        <button id="btnClose" type="button" class="btn btn-default"><i class="fa fa-close"></i> 关闭</button>
      </div>
    </div><!-- /.modal-content -->
  </div><!-- /.modal-dialog -->
</div><!-- /.modal -->
</form>
<script>
$('.modal').modal({backdrop:'static'});
$(".dropdown-menu a").click(function(){
	$(this).closest(".input-group-btn").find(".express").html($(this).html());
});
$("#btnClose").click(function(){
	close();
});
$("#btnOk").click(function(){
	$(this).closest("form").submit();
})
$("form").submit(function(){
	switch($("#sp主栏Express").html()){
		case "截前N位":
			if(!parseInt($("#edt主栏Value").val())){
				alert("主栏选择了截前N位处理时，内容["+$("#edt主栏Value").val()+"]不是有效的数字" );
				return false;
			}
			break;
		case "表达式":
			if(!$("#edt主栏Value").val()){
				alert("主栏选择了表达式时，内容不能为空" );
				return false;
			}
			break;
	}
	switch($("#sp宾栏Express").html()){
		case "截前N位":
			if(!parseInt($("#edt宾栏Value").val())){
				alert("宾栏选择了截前N位处理时，内容["+$("#edt主栏Value").val()+"]不是有效的数字" );
				return false;
			}
			break;
		case "表达式":
			if(!$("#edt宾栏Value").val()){
				alert("宾栏选择了表达式时，内容不能为空" );
				return false;
			}
			break;
	}
	$("#edt主栏Express").val($("#sp主栏Express").html());
	$("#edt宾栏Express").val($("#sp宾栏Express").html());
	return true;
});
</script>