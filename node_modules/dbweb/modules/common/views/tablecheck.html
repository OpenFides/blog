<script src="/js/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<script src="[[concat (newFiles "/flib/uri.js/src/URI.js" "/flib/uri.js/src/URI.min.js")]]" type="text/javascript" charset="utf-8"></script>
<form  class="form-horizontal">
	<div class="form-group">
		<label for="fldID" class="control-label col-md-1 bill-label">编号:</label>
		<div class="col-md-5">
		{{template "_bill/input" (.Field "ID")}}
		</div>
		<div class="col-md-1"></div>
		<div class="checkbox col-md-5">
			{{template "_bill/checkbox" (.Field "MUST")}}
			<label for="fldMUST">必审</label>
		</div>
	</div>
	<div class="form-group">
		<label for="fldDEPT" class="control-label col-md-1 bill-label">部门:</label>
		<div class="col-md-11">
		{{template "_bill/input" (.Field "DEPT")}}
		</div>
	</div>
	<div class="form-group">
		<label for="fldLABEL" class="control-label col-md-1 bill-label">标签:</label>
		<div class="col-md-11">
		{{template "_bill/input" (.Field "LABEL")}}
		</div>
	</div>
	<div class="form-group">
		<label for="fldTable" class="col-sm-1 control-label">表:</label>
		<div class="col-sm-5">
			{{template "_bill/combo" (.Field "TABLENAME")}}
		</div>
		<label for="fldREFERFIELDS" class="col-sm-1 control-label">引用:</label>
		<div class="col-sm-5">
			{{template "_bill/multiselect" (.Field "REFERFIELDS")}}
		</div>
	</div>
	<div class="form-group">
		<label for="fldCONDITION" class="control-label col-md-1 bill-label">条件:</label>
		<div class="col-md-11">
			{{template "_bill/aceedit" (.Field "CONDITION")}}
		</div>
	</div>
	<div class="form-group">
		<label for="fldDETAILTMPL" class="control-label col-md-1 bill-label">提示模板:</label>
		<div class="col-md-11">
			{{template "_bill/aceedit" (.Field "DETAILTMPL")}}
		</div>
	</div>

</form>
<script>
var f = {{$.More.ReferFields}};
function buildCallUrl(action,param){
	var url = new URI(window.location.href);
	var pam = _.pick(url.search(true),"_s");
	pam.action = action;
	_.extend(pam,param);
	url.search(pam);
	return url;
}

var selTable = $("#fldTABLENAME");
var selField = $("#fldREFERFIELDS");
selTable.change(function(){
	var u = buildCallUrl("gf",{tname:selTable.val()});
	selTable.prop("disabled", true);
	$.get(u.toString(),function(names){
		setFields(names);
	}).fail(function() {
  	  alert( "get table fields error!" );
  	}).always(function() {
		selTable.prop("disabled", false);
	});
})
function setFields(columns){
	var oldPK = selField.val();
	selField.empty(); 
	selField.select2({data:columns,tags:true,tokenSeparators: [',', ' ']});
	selField.val(oldPK).trigger("change");
}
$("#")
</script>