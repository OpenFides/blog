<script src="/js/ace/ace.js" type="text/javascript" charset="utf-8"></script>
<style type="text/css">
	body{
		background-color:dimgray;
	}
	.panRestore{
		max-width:700px;
		margin-left:auto;
		margin-right:auto;
	}
	.panel-footer{
		text-align:right;
	}
	.json-editor {border: 1px solid #ccc; font-size:13px;height:200px;}
</style>
<form role="form" action="{{.More.PostUrl.String}}" method="POST">
<input type="hidden" name="dumpFileID" value="{{.More.DumpFileID}}">
<div class="container">
	<div class="panel panel-default panRestore">
		<div class="panel-heading">
			<h3 class="panel-title">{{.Element.DisplayLabel}}-数据包内容</h3>
		</div>
		<div class="panel-body">
			<p class="help-block">
				数据包内容如下
			</p>
			<table id="tabBill" class="table table-hover table-striped">
				<thead>
					<th style="width:10%">序号</th>
					<th style="width:20%">名称</th>
					<th style="width:10%" align="right">记录数</th>
					<th style="width:60%">物理表</th>
				</thread>
				<tbody>
				{{range $idx,$bill :=.More.DumpConfig.Param.Bills}}
					<tr>
						<td>{{inc $idx}}</td>
						<td>
							<div class="checkbox checkbox-inline checkbox-success">
								<input type="checkbox" class="chkSelect" id="chk{{$idx}}" name="sel_{{$bill.Name}}" checked="checked">
								<label class="lblFieldName" for="chk{{$idx}}">{{.Name}}</label>
							</div>
						</td>
						<td align="right">{{$bill.RowCount}}</td>
						<td class="tdTables">{{$bill.Tables|csv}}</td>
					</tr>
				{{end}}
				</tbody>
			</table>
			<div id="divError" class="alert alert-danger" role="alert" style="display:none"></div>
			<div class="collapse" id="collapseParam">
				<div id="edtConfigJSON" class="json-editor">{{.More.DumpConfigJSON}}</div>
			</div>
		</div>
		<div class="panel-footer">
			<button id="btnShowConfig" class="btn btn-default" type="button">显示参数</button>
			<button id="btnOk" type="submit" class="btn btn-primary"><i class="fa fa-check"></i> 导入</button>
		</div>
	</div>
</div>

</form>
<script>
$("#tabBill tbody .chkSelect").change(function(){
	if($(this).prop("checked")){
		$(this).closest("tr").removeClass("text-muted");
	}else{
		$(this).closest("tr").addClass("text-muted");
	}
});
$(".modal").modal({backdrop:"static"});
$("#btnShowConfig").click(function(){
	$("#collapseParam").collapse('toggle');
})
$("form").submit(function(){
	$("#tabBill tbody>tr").removeClass("has-error");
	$("#divError").hide();
	var error = false;
	if(!$("#tabBill tbody>tr .chkSelect").is(":checked")){
		$("#divError").html("没有选择导入的单据");
		error=true;
		$("#divError").show();
	}
	return !error;
});
var edtConfigJSON = ace.edit("edtConfigJSON");
edtConfigJSON.setTheme("ace/theme/sqlserver");
edtConfigJSON.getSession().setMode("ace/mode/json");
edtConfigJSON.$blockScrolling = Infinity;
edtConfigJSON.setReadOnly(true);

</script>