<script src="/js/ace/ace.js" type="text/javascript" charset="utf-8"></script>
	
<style type="text/css">
#fldRESULT,#fldPARAMS{
	height:200px;
}
.json-editor {border: 1px solid #ccc; font-size:13px;height:250px;}
table td{
	work-break:keep-all;
}
#btnOpen{
	margin-bottom:10px;
}
</style>
<div class="alert {{if .More.Error}}alert-danger{{else}}alert-success{{end}}" role="alert">{{.More.Message}}</div>
{{if .More.HasZipFile}}
<p>
	<a target="_blank" href="{{.More.ZipFileUrl}}">点击下载导出的结果({{.More.ZipFileSize|fsize}})</a>
</p>
{{end}}

<a id="btnOpen" class="btn btn-primary" role="button" data-toggle="collapse" href="#frmMain" aria-expanded="false">展开详细信息</a>

<div class="collapse" id="frmMain">
	<form class="form-horizontal">
		<div class="form-group form-group-sm">
			<label for="fldID" class="control-label col-md-1 bill-label">流水号:</label>
			<div class="col-md-5">
			{{template "_bill/input" (.Field "ID")}}
			</div>
			<label for="fldNAME" class="control-label col-md-1 bill-label">名称:</label>
			<div class="col-md-5">
			{{template "_bill/input" (.Field "NAME")}}
			</div>
		</div>
		<div class="form-group form-group-sm">
			<label for="fldSTATUS" class="control-label col-md-1 bill-label">状态:</label>
			<div class="col-md-5">
			{{template "_bill/input" (.Field "STATUS")}}
			</div>
			<label for="fldEXECUTOR" class="control-label col-md-1 bill-label">执行人:</label>
			<div class="col-md-5">
			{{template "_bill/input" (.Field "EXECUTOR")}}
			</div>
		</div>
		<div class="form-group form-group-sm">
			<label for="fldEXETIME" class="control-label col-md-1 bill-label">开始时间:</label>
			<div class="col-md-5">
			{{template "_bill/input" (.Field "EXETIME")}}
			</div>
			<label for="fldCOMPLETEDTIME" class="control-label col-md-1 bill-label">完成时间:</label>
			<div class="col-md-5">
			{{template "_bill/input" (.Field "COMPLETEDTIME")}}
			</div>
		</div>
		<div class="form-group form-group-sm">
			<label for="fldEXEDEPT" class="control-label col-md-1 bill-label">所属部门:</label>
			<div class="col-md-5">
			{{template "_bill/input" (.Field "EXEDEPT")}}
			</div>
			<label for="fldEXEIP" class="control-label col-md-1 bill-label">IP地址:</label>
			<div class="col-md-5">
			{{template "_bill/input" (.Field "EXEIP")}}
			</div>
		</div>
		<div class="panel panel-default">
	  		<div class="panel-heading">进度报告:</div>
			<table class="table table-condensed table-striped table-hover">
				<thead>
					<tr>
						<th>编号</th>
						<th>时间</th>
						<th>内容</th>
					<tr>
				</thead>
				<tbody>
					{{range $idx,$row := .More.PROGRESS}}
					<tr>
						<td>{{$row.ROWNO}}</td>
						<td>{{tostring $row.LOGTIME}}</td>
						<td>{{tostring $row.CONTENT}}</td>
					</tr>
					{{end}}
					{{if .More.MoreProgressUrl}}
					<tr>
						<td colspan="3">
							<a href="{{.More.MoreProgressUrl}}" target="_blank">更多的进度...</a>
						</td>
					</tr>
					{{end}}
				</tbody>
			</table>
		</div>
		<div class="form-group form-group-sm">
			<label for="fldPARAMS" class="control-label col-md-1 bill-label">参数:</label>
			<div class="col-md-11">
				<div id="fldPARAMS" class="json-editor"></div>
			</div>
		</div>
		{{if (.Field "RESULT").Value}}
		<div class="form-group form-group-sm">
			<label for="fldRESULT" class="control-label col-md-1 bill-label">结果:</label>
			<div class="col-md-11">
				<div class="panel panel-default">
				 	<div class="panel-body">
					<pre>{{(.Field "RESULT").Value|keepHtml}}</pre>
					</div>
				</div>
			</div>
		</div>
		{{end}}
	</form>
</div>
<script>

var edtParams = ace.edit("fldPARAMS");
edtParams.setTheme("ace/theme/sqlserver");
edtParams.getSession().setMode("ace/mode/yaml");
edtParams.$blockScrolling = Infinity;
edtParams.setValue({{.Record.Main.PARAMS}},1);
edtParams.setReadOnly(true);
$("#btnOpen").click(function(){
	if($(this).html() == "展开详细信息"){
		$(this).html("收起详细信息");
	}else{
		$(this).html("展开详细信息");
	}
});

</script>