 function aceTrimTrailingSpace(edt, trimEmpty) {
    var doc = edt.session.getDocument();
    var lines = doc.getAllLines();
    
    var min = trimEmpty ? -1 : 0;

    for (var i = 0, l=lines.length; i < l; i++) {
        var line = lines[i];
        var index = line.search(/\s+$/);
        if (index > min)
            doc.removeInLine(i, index, line.length);
    }
    return edt.getValue()
};