package common

import (
	"bytes"
	"dbweb/core"
)

type Index struct{}

func init() {
	core.RegisterFun("index", new(Index))

}
func (i *Index) Get(p *core.ElementHandleArgs) {
	//if p.Req.Header.Get
	content := "欢迎使用" + p.ProjectLabel() + "\n================="
	for _, role := range p.User.Roles {
		if t := p.Render.Template().Lookup(`_help/_role/` + role); t != nil {
			out := bytes.NewBuffer(nil)
			if err := t.Execute(out, p); err != nil {
				core.LOG.Panic(err)
			}
			content += "\n\n" + out.String()
		}
	}
	p.More["Content"] = content
	p.HTML()
}
